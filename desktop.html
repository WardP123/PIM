<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Desktop</title>
<link href="desktopcss.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
</head>
<body onload="RetrieveUsers(); RetrieveAnnouncements(); RetrieveAppointments(); CheckGameLock();">
	<div id="header">
		<img src="klassetourzwart.png"></div>
	</div>
	<div class="container">
		<div class="leftcontainer">
		<div class="groupsnumber">
			Groepsnummer: <span class="gameid"> </span><br>
			<span class="gamename"></span>
		</div>
		<div class = "users" id="usercontainer">
			<div class = "usertitle"> Groepsleden <img onclick="lock_group_popup()" onmouseover="" style="cursor: pointer;" class="lockicon" id="lockicon"></div>
			<div class = "total"><span id="usercounter"></span> Groepsleden totaal </div>
		</div>
		</div>
		<div class="announcements" id="announcementcontainer">
			<div class="announcementstitle"> Meldingen </div>
			<div id = "newannouncement" class="newannouncement"> Nieuwe Melding <br> <span class="plusannouncement"> + </span> </div></button>
		</div>
		<div class="allevents">
			<div class = "bottons">
				<div class="newappointmentcontainer"> <div id="newappointment" class="newappointment"> <br> Nieuwe Afspraak <br><span class="plusappointment"> +</span></div> </div>
				<div class="newquizcontainer"><div id="newquiz" class="newquiz"> <br>  Nieuwe Quiz <br><span class="plusquiz"> +</span></div></div>
			</div>
		<div class="events" id="eventscontainer">
		</div>
		</div>
	</div>

	<!-- The Modal -->
	<div id="newannouncementmodal" class="modal">

	  <!-- Modal content -->
	  <div class="modal-content">
		<span class="closean" onclick="close_span_announcement()">&times;</span>
		<div class="title">Nieuwe Melding</div>
			<form>
				Titel: <br>
				<input type="text" id="antitleintext"> <br>
				Inhoud: <br>
				<textarea rows="4" cols="50" name="comment" id="announcementdescription" form="usrform"></textarea> <br>
				<input type="button" id="announcementsendbutton" value="Melding plaatsen" onclick="new_announcement()">
			</form>
	  </div>
	</div>
	
	<div id="updateannouncementmodal" class="modal">

	  <!-- Modal content -->
	  <div class="modal-content">
		<span class="closean" onclick="close_span_announcement()">&times;</span>
		<div class="title">Melding Aanpassen</div>
			<form>
				Titel: <br>
				<input type="text" id="updatedantitle"> <br>
				Inhoud: <br>
				<textarea rows="4" cols="50" id="updatedannouncementdescription"></textarea> <br>
				<input type="button" id="announcementsendbutton" value="Melding aanpassen" onclick="update_announcement()">
			</form>
	  </div>
	</div>
	
	<div id="newappointmentmodal" class="modal">

	  <!-- Modal content -->
	  <div class="modal-content">
		<span class="closeap" onclick="close_span_appointment()">&times;</span>
		<div class="title">Nieuwe Afspraak</div>
			<form>
				Titel: <br>
				<input type="text" id="aptitleintext"> <br>
				Inhoud: <br>
				<textarea rows="4" cols="50" id="apdescription"></textarea> <br>
				Tijd: <br>
				<input type="time" name="comment" id="appointmenttime"><br>
				<input type="button" id="appointmentsendbutton" value="Afspraak plaatsen" onclick="new_appointment()">
			</form>
	  </div>
	</div>
	
	<div id="updateappointmentmodal" class="modal">

	  <!-- Modal content -->
	  <div class="modal-content">
		<span class="closeap" onclick="close_span_appointment()">&times;</span>
		<div class="title">Afspraak Aanpassen</div>
			<form>
				Titel: <br>
				<input type="text" id="updatedaptitle"> <br>
				Inhoud: <br>
				<textarea rows="4" cols="50" id="updatedapdescription"></textarea> <br>
				Tijd: <br>
				<input type="time" id="updatedappointmenttime"><br>
				<input type="button" id="appointmentsendbutton" value="Afspraak aanpassen" onclick="update_appointment()">
			</form>
	  </div>
	</div>

	<div id="newquizmodal" class="modal">

		<!-- Modal content -->
		<div class="modal-content">
		  <span class="closequiz">&times;</span>
		  <div class="title">Nieuwe Quiz</div>
			  <form>
				  Quiz titel: <br>
				  <input type="text" id="quiztitleintext"> <br>
				  Tijd: <br>
				  <input type="time" name="comment" id="quiztime"><br>
				  <input type="button" id="quizsendbutton" value="Quiz plaatsen" onclick="new_quiz()">
			  </form>
		</div>
	  </div>
	
	<div id="deleteusermodal" class="modal">

	  <!-- Modal content -->
	  <div class="modal-content">
		<span class="closeap" onclick="close_span_user()">&times;</span>
		<div class="title">Groepslid Verwijderen</div>
			<form>
				<div>Weet u zeker dat u <span id="insertname"></span> wil verwijderen?</div><br>
				<input type="button" id="deleteuserbutton" value="Ja" onclick="delete_user()">
				<input type="button" value="Nee" onclick="close_span_user()">
			</form>
	  </div>
	</div>
	
	<div id="deleteannouncementmodal" class="modal">

	  <!-- Modal content -->
	  <div class="modal-content">
		<span class="closeap" onclick="close_span_announcement()">&times;</span>
		<div class="title">Melding Verwijderen</div>
			<form>
				<div>Weet u zeker dat u de melding "<span id="inserttitle"></span>" wil verwijderen?</div><br>
				<input type="button" id="deleteannouncementbutton" value="Ja" onclick="delete_announcement()">
				<input type="button" value="Nee" onclick="close_span_announcement()">
			</form>
	  </div>
	</div>
	
	<div id="deleteappointmentmodal" class="modal">

	  <!-- Modal content -->
	  <div class="modal-content">
		<span class="closeap" onclick="close_span_appointment()">&times;</span>
		<div class="title">Afspraak Verwijderen</div>
			<form>
				<div>Weet u zeker dat u de afspraak "<span id="inserttitleappointment"></span>" wil verwijderen?</div><br>
				<input type="button" id="deleteappointmentbutton" value="Ja" onclick="delete_appointment()">
				<input type="button" value="Nee" onclick="close_span_appointment()">
			</form>
	  </div>
	</div>
	
	<div id="lockmodal" class="modal">

	  <!-- Modal content -->
	  <div class="modal-content">
		<span class="closeap" onclick="close_span_lock()">&times;</span>
		<div class="title">Groep Vergrendelen</div>
			<form>
				<div id="lockvariabletext"></div><br>
				<input type="button" id="grouplockbutton" value="Ja" onclick="lock_group()">
				<input type="button" value="Nee" onclick="close_span_lock()">
			</form>
	  </div>
	</div>
<script>
	window.getCookie = function(name) {
  var match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
  if (match) return match[2];
}
function getQueryVariable(variable){
   var query = window.location.search.substring(1);
   var vars = query.split("&");
   for (var i=0;i<vars.length;i++) {
		   var pair = vars[i].split("=");
		   if(pair[0] == variable){return pair[1];}
   }
   return("NO VALID LINK");
}

	var authkey_local = getCookie("accountadmin");
//	var authkey_local = "173224453209867194815934272294398947581"
	var gameid_local = getQueryVariable("id");
	
	
	$( document ).ready(function() {
			if (authkey_local) {
		$.ajax({
                url: "http://84.28.82.98:8081/check_authkeyadmin",
                type: 'POST',
				data: JSON.stringify({"authkey": authkey_local}),
				contentType: "application/json; charset=utf-8",
				dataType: "json",
                async: true,
                success: function(result) {
					if (result.valid == "yes" ){
						
					}else{
						window.location.href = "loginteachers.html";
					}
				},
        		error: function(data) {
        			}
             });
		} else {
			window.location.href = "loginteachers.html";
		};
		$.ajax({
                url: "http://84.28.82.98:8081/get_group_info",
                type: 'POST',
				data: JSON.stringify({"gameid": gameid_local}),
				contentType: "application/json; charset=utf-8",
				dataType: "json",
                async: true,
                success: function(result) {
					$.each(result, function(i, item){
					$('.gameid').append(item.gameid);
					$('.gamename').append(item.groupname);
					});
				},
        		error: function(data) {
        			}
             });
		});
	
// Get the modal
var modalan = document.getElementById('newannouncementmodal');

// Get the button that opens the modal
var btnan = document.getElementById("newannouncement");

// Get the <span> element that closes the modal
var spanan = document.getElementsByClassName("closean")[0];

// When the user clicks the button, open the modal 
btnan.onclick = function() {
    modalan.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
spanan.onclick = function() {
    modalan.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modalan) {
        modalan.style.display = "none";
    }
}
var modalap = document.getElementById('newappointmentmodal');

// Get the button that opens the modal
var btnap = document.getElementById("newappointment");

// Get the <span> element that closes the modal
var spanap = document.getElementsByClassName("closeap")[0];

// When the user clicks the button, open the modal 
btnap.onclick = function() {
    modalap.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
spanap.onclick = function() {
    modalap.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modalap) {
        modalap.style.display = "none";
    }
}

var modalquiz = document.getElementById('newquizmodal');

// Get the button that opens the modal
var btnquiz = document.getElementById("newquiz");

// Get the <span> element that closes the modal
var spanquiz = document.getElementsByClassName("closequiz")[0];

// When the user clicks the button, open the modal 
btnquiz.onclick = function() {
    modalquiz.style.display = "block";
}

// When the user clicks on <span> (x), close the modal
spanquiz.onclick = function() {
    modalquiz.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modalquiz) {
        modalquiz.style.display = "none";
    }
}


	
function new_announcement(){
	var announcementtitle_local = document.getElementById("antitleintext").value;
	var announcementdescription_local = document.getElementById("announcementdescription").value;
	
	date = new Date();
	date_local = date.toLocaleString();
	
	if (announcementtitle_local == "" && announcementdescription_local == ""){
		alert('Geef de announcement een titel en inhoud.')
	}
	else if (announcementtitle_local == ""){
		alert('Geef de announcement een titel.')
	}
	else if (announcementdescription_local == ""){
		alert('Geef de announcement een inhoud.')
	}
	
	else {
		$.ajax({
			url: "http://84.28.82.98:8081/new-announcement",
			type: 'POST',
			data: JSON.stringify({ gameid: gameid_local, authkey: authkey_local, announcementtitle: announcementtitle_local, announcementdescription: announcementdescription_local, date: date_local }),
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			async: true,
			success: function(result) {
				alert("Melding met titel " + announcementtitle_local + " voor gameid " + result + " aangemaakt.");
				close_span_announcement();
				location.reload();
			},
			error: function(data) {
				alert("Melding aanmaken mislukt.");
			}
		});
	}
}

function new_appointment(){
	var appointmentlocation_local = document.getElementById("aptitleintext").value;
	var appointmentdescription_local = document.getElementById("apdescription").value;
	var appointmenttime_local = document.getElementById("appointmenttime").value;
	

	if (appointmentlocation_local == "" && appointmenttime_local == ""){
		alert('Geef de afspraak een titel en tijd.')
	}
	else if (appointmentlocation_local == ""){
		alert('Geef de afspraak een titel.')
	}
	else if (appointmenttime_local == ""){
		alert('Geef de afspraak een tijd.')
	}
	
	else {
		$.ajax({
			url: "http://84.28.82.98:8081/new-appointment",
			type: 'POST',
			data: JSON.stringify({ 'authkey': authkey_local, 'gameid': gameid_local, 'type': 'appointment', 'title': appointmentlocation_local, 'description': appointmentdescription_local, 'time': appointmenttime_local }),
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			async: true,
			success: function(result) {
				alert("Afspraak aanmaken voor gameid " + result + " gelukt");
				close_span_appointment();
				location.reload();
			},
			error: function(data) {
				alert("Afspraak aanmaken mislukt.");
			}
		});
	}
}

function new_quiz() {
	alert('test');
	var quiz_title = document.getElementById("quiztitleintext").value;
	var time = document.getElementById("quiztime").value;

	if (quiz_title == ""){
		alert('Geef de quiz een titel.')
	} else if (time == ""){
		alert('Geef de quiz een tijd.')
	} else {
		$.ajax({
			type: "POST",
			url: "http://84.28.82.98:8081/new-quiz",
			data: JSON.stringify({authkey: authkey_local, gameid: gameid_local, type: 'quiz', description: 'quiz', title: quiz_title,  times: time }),
			contentType: "application/json; charset=utf-8",
			dataType: "json",
			async: true,
			success: function(result) {
				alert('test');
				alert(result);
				document.getElementById('hide').className = 'show';
			},
			error: function(data) {
				alert(data);
			}
		});
	}
}

function delete_user_popup(innerHTML){
	document.getElementById("insertname").innerHTML = innerHTML;
	var modalap = document.getElementById('deleteusermodal');
	modalap.style.display = "block";
}

function close_span_user(){
	var modalap = document.getElementById('deleteusermodal');
	modalap.style.display = "none";
}


function delete_user(){
	name = document.getElementById("insertname").innerHTML;
	
	$.ajax({
		url: "http://84.28.82.98:8081/delete-user",
        type: 'POST',
		data: JSON.stringify({ authkey: authkey_local, gameid: gameid_local, username: name}),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
        async: true,
        success: function(result) {
			alert('Groepslid ' + result.username + ' uit gameid ' + result.gameid + ' verwijderd.')
		},
        error: function(data) {
			alert('Groepslid verwijderen mislukt.')
        }
});	
}

function delete_announcement_popup(parentdiv){
	id_local = parentdiv.id;
	
	$.ajax({
		url: "http://84.28.82.98:8081/announcement-title",
        type: 'POST',
		data: JSON.stringify({ authkey: authkey_local, id: id_local}),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
        async: true,
        success: function(result) {
			document.getElementById("inserttitle").innerHTML = result[0].announcementtitle;
			document.getElementById("inserttitle").setAttribute("class", result[0].id);
		},
        error: function(data) {
        }
	});		

	var modalap = document.getElementById('deleteannouncementmodal');
	modalap.style.display = "block";
}

function delete_announcement(){
	announcement_id_local = document.getElementById("inserttitle").className;
	
	$.ajax({
		url: "http://84.28.82.98:8081/delete-announcement",
        type: 'POST',
		data: JSON.stringify({ authkey: authkey_local, id: announcement_id_local}),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
        async: true,
        success: function(result) {
			alert('Melding ' + result[0].announcementtitle + ' uit gameid ' + result[0].gameid + ' verwijderd.')
			close_span_announcement()
			location.reload()
		},
        error: function(data) {
			alert('Melding verwijderen mislukt.')
        }
	});		
}

function close_span_announcement(){
	var modalap = document.getElementById('deleteannouncementmodal');
	modalap.style.display = "none";
	var modalap = document.getElementById('newannouncementmodal');
	modalap.style.display = "none";
	var modalap = document.getElementById('updateannouncementmodal');
	modalap.style.display = "none";
}

function delete_appointment_popup(id){
	id_local = id;
	
	$.ajax({
		url: "http://84.28.82.98:8081/appointment-title",
        type: 'POST',
		data: JSON.stringify({authkey: authkey_local, id: id_local}),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
        async: true,
        success: function(result) {
			document.getElementById("inserttitleappointment").innerHTML = result[0].title;
			document.getElementById("inserttitleappointment").setAttribute("class", result[0].id);
		},
        error: function(data) {
        }
	});		
	
	var modalap = document.getElementById('deleteappointmentmodal');
	modalap.style.display = "block";
}

function delete_appointment(){
	appointment_id_local = document.getElementById("inserttitleappointment").className;
	
	$.ajax({
		url: "http://84.28.82.98:8081/delete-appointment",
        type: 'POST',
		data: JSON.stringify({ authkey: authkey_local, id: appointment_id_local}),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
        async: true,
        success: function(result) {
			alert('Afspraak ' + result[0].title + ' uit gameid ' + result[0].gameid + ' verwijderd.')
			close_span_appointment()
			location.reload()
		},
        error: function(data) {
			alert('Afspraak verwijderen mislukt.')
        }
	});		
}


function close_span_appointment(){
	var modalap = document.getElementById('deleteappointmentmodal');
	modalap.style.display = 'none';
	var modalap = document.getElementById('newappointmentmodal');
	modalap.style.display = "none";
	var modalap = document.getElementById('updateappointmentmodal');
	modalap.style.display = "none";
}

// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
	var modalap = document.getElementById('deleteannouncementmodal');
	var modalap2 = document.getElementById('deleteusermodal');
	var modalap3 = document.getElementById('deleteappointmentmodal');
	var modalap4 = document.getElementById('newappointmentmodal');
	var modalap5 = document.getElementById('updateannouncementmodal');
	var modalap6 = document.getElementById('newannouncementmodal');
	var modalap7 = document.getElementById('updateappointmentmodal');
	var modalap8 = document.getElementById('lockmodal');
	
    if (event.target == modalap) {
        modalap.style.display = "none";
    }
	if (event.target == modalap2) {
		modalap2.style.display = "none";
	}
	if (event.target == modalap3) {
		modalap3.style.display = "none";
	}
	if (event.target == modalap4) {
		modalap4.style.display = "none";
	}
	if (event.target == modalap5) {
		modalap5.style.display = "none";
	}
	if (event.target == modalap6) {
		modalap6.style.display = "none";
	}
	if (event.target == modalap7) {
		modalap7.style.display = "none";
	}
	if (event.target == modalap8) {
		modalap8.style.display = "none";
	}
}

function RetrieveUsers(){
    $.ajax({
       url: "http://84.28.82.98:8081/retrieve-users",
       type: 'POST',
	   data: JSON.stringify({ authkey: authkey_local, gameid: gameid_local}),
	   contentType: "application/json; charset=utf-8",
       dataType: 'json',
       async: true,
       success: function(data) {
		  ProcessUsers(data);
	   },
	   error: function() {
		  alert('Groepsleden kunnen niet geladen worden door een servererror.');
       },
    });
}

function ProcessUsers(data){
	usercounter = 0;
	for (user in data){
		usercounter += 1;
		var maindiv  = document.createElement("div");
		maindiv.setAttribute("class", "user");
		var seconddiv = document.createElement("div");
		seconddiv.setAttribute("id", data[user].id);
		seconddiv.setAttribute("class", "name");
		seconddiv.setAttribute("onclick", "delete_user_popup(innerHTML)");
		seconddiv.innerHTML = data[user].username;
		maindiv.appendChild(seconddiv);
		document.getElementById("usercontainer").appendChild(maindiv);
	}
	document.getElementById("usercounter").innerHTML = usercounter;
}

function RetrieveAnnouncements(){
    $.ajax({
       url: "http://84.28.82.98:8081/retrieve-announcements",
       type: 'POST',
	   data: JSON.stringify({authkey: authkey_local, gameid: gameid_local}),
	   contentType: "application/json; charset=utf-8",
       dataType: 'json',
       async: true,
       success: function(data) {
		  ProcessAnnouncements(data);
	   },
	   error: function() {
		  alert('Meldingen kunnen niet geladen worden door een servererror.');
       },
    });
}

function ProcessAnnouncements(data){
	data.reverse();
	
	for (announcement in data){
		var maindiv  = document.createElement("div");
		maindiv.setAttribute("class", "announcement");
		maindiv.setAttribute("id", data[announcement].id);
		
		var seconddiv = document.createElement("div");
		seconddiv.setAttribute("class", "new");
		
		var timediv = document.createElement("div");
		timediv.setAttribute("class", "time");
		
		var titlediv = document.createElement("div");
		titlediv.setAttribute("class", "title");
		titlediv.setAttribute("id", "announcementtitle");
		titlediv.innerHTML = data[announcement].announcementtitle;
		
		var descriptiondiv = document.createElement("div");
		descriptiondiv.setAttribute("class", "description");
		descriptiondiv.innerHTML = data[announcement].announcementdecription;
		
		var readdiv = document.createElement("div");
		readdiv.setAttribute("class", "readed");
		readdiv.innerHTML = "Melding aangemaakt op: " + data[announcement].date;
		
		var iconsdiv = document.createElement("div");
		iconsdiv.setAttribute("class", "iconsan");
		
		var deleteimage = document.createElement("img");
		deleteimage.setAttribute("src", "delete.png");
		deleteimage.setAttribute("onclick", "delete_announcement_popup(this.parentElement.parentElement)");
		deleteimage.setAttribute("onmouseover", "");
		deleteimage.setAttribute("style", "cursor: pointer;");
		
		var editimage = document.createElement("img");
		editimage.setAttribute("src", "edit.png");
		editimage.setAttribute("onclick", "update_announcement_popup(this.parentElement.parentElement)");
		editimage.setAttribute("onmouseover", "");
		editimage.setAttribute("style", "cursor: pointer;");
		
		iconsdiv.appendChild(deleteimage);
		iconsdiv.appendChild(editimage);
		maindiv.appendChild(seconddiv);
		maindiv.appendChild(timediv);
		maindiv.appendChild(titlediv);
		maindiv.appendChild(descriptiondiv);
		maindiv.appendChild(readdiv);
		maindiv.appendChild(iconsdiv);
		document.getElementById("announcementcontainer").appendChild(maindiv);
	}
}

function RetrieveAppointments(){
    $.ajax({
       url: "http://84.28.82.98:8081/retrieve-appointments",
       type: 'POST',
	   data: JSON.stringify({authkey: authkey_local, gameid: gameid_local}),
	   contentType: "application/json; charset=utf-8",
       dataType: 'json',
       async: true,
       success: function(data) {
		  ProcessAppointments(data);
	   },
	   error: function() {
		  alert('Afspraken kunnen niet geladen worden door een servererror.');
       },
    });
}

function ProcessAppointments(data){
	data.sort(function (a, b) {
		return new Date('1970/01/01 ' + a.times) - new Date('1970/01/01 ' + b.times);
	});
	
	for (appointment in data){
		var maindiv  = document.createElement("div");
		maindiv.setAttribute("class", data[appointment].type);
		
		var timediv = document.createElement("div");
		timediv.setAttribute("class", "time");
		timediv.innerHTML = data[appointment].times;
		
		var titlediv = document.createElement("div");
		titlediv.setAttribute("class", "title");
		titlediv.innerHTML = data[appointment].title;
		
		var descriptiondiv = document.createElement("div");
		descriptiondiv.setAttribute("class", "description");
		var description = data[appointment].description
		var short_description = description.substring(0, 30);
		if (description.length < 31) {
		descriptiondiv.innerHTML = data[appointment].description;
		} else {
			var short_description = description.substring(0, 30);
			descriptiondiv.innerHTML = '<div class="description">' + short_description + '...' + '</div>';
		}
		var iconsdiv = document.createElement("div");
		iconsdiv.setAttribute("class", "icons");
		
		var deleteimage = document.createElement("img");
		deleteimage.setAttribute("src", "delete.png");
		deleteimage.setAttribute("id", data[appointment].id);
		deleteimage.setAttribute("onclick", "delete_appointment_popup(this.id)");
		deleteimage.setAttribute("onmouseover", "");
		deleteimage.setAttribute("style", "cursor: pointer;");
		
		var editimage = document.createElement("img");
		editimage.setAttribute("src", "edit.png");
		editimage.setAttribute("id", data[appointment].id);
		editimage.setAttribute("onclick", "update_appointment_popup(this.id)");
		editimage.setAttribute("onmouseover", "");
		editimage.setAttribute("style", "cursor: pointer;");
		
		iconsdiv.appendChild(deleteimage);
		iconsdiv.appendChild(editimage);
		maindiv.appendChild(timediv);
		maindiv.appendChild(titlediv);
		maindiv.appendChild(descriptiondiv);
		maindiv.appendChild(iconsdiv);
		document.getElementById("eventscontainer").appendChild(maindiv);
	}
}

function update_announcement_popup(parentdiv){
	id_local = parentdiv.id;
	
	$.ajax({
		url: "http://84.28.82.98:8081/announcement-title",
        type: 'POST',
		data: JSON.stringify({authkey: authkey_local, id: id_local}),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
        async: true,
        success: function(result) {
			document.getElementById('updatedantitle').value = result[0].announcementtitle;
			document.getElementById('updatedannouncementdescription').value = result[0].announcementdecription;
			document.getElementById("updatedantitle").setAttribute("class", result[0].id);
			var modalap = document.getElementById('updateannouncementmodal');
	        modalap.style.display = "block";
		},
        error: function(data) {
        }
	});		
}

function update_announcement(){
	id_local = document.getElementById('updatedantitle').className;
	title_local = document.getElementById('updatedantitle').value;
	description_local = document.getElementById('updatedannouncementdescription').value;
	date = new Date();
	date_local = date.toLocaleString();
	
	$.ajax({
		url: "http://84.28.82.98:8081/update-announcement",
        type: 'POST',
		data: JSON.stringify({authkey: authkey_local, id: id_local, title: title_local, description: description_local, date: date_local}),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
        async: true,
        success: function(result) {
			close_span_announcement();
			location.reload();
		},
        error: function(data) {
        }
	});
}

function update_appointment_popup(id){
	id_local = id;
	
	$.ajax({
		url: "http://84.28.82.98:8081/appointment-title",
        type: 'POST',
		data: JSON.stringify({authkey: authkey_local, id: id_local}),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
        async: true,
        success: function(result) {
			document.getElementById('updatedaptitle').value = result[0].title;
			document.getElementById('updatedapdescription').value = result[0].description;
			document.getElementById('updatedappointmenttime').value = result[0].times;
			document.getElementById("updatedaptitle").setAttribute("class", result[0].id);
			var modalap = document.getElementById('updateappointmentmodal');
	        modalap.style.display = "block";
		},
        error: function(data) {
        }
	});	
}

function update_appointment(){
	id_local = document.getElementById('updatedaptitle').className;
	title_local = document.getElementById('updatedaptitle').value;
	description_local = document.getElementById('updatedapdescription').value;
	time_local = document.getElementById('updatedappointmenttime').value;
	
	$.ajax({
		url: "http://84.28.82.98:8081/update-appointment",
        type: 'POST',
		data: JSON.stringify({ authkey: authkey_local, id: id_local, title: title_local, description: description_local, time: time_local}),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
        async: true,
        success: function(result) {
			close_span_appointment();
			location.reload();
		},
        error: function(data) {
        }
	});
}

function lock_group_popup(){
	locktextdiv = document.getElementById('lockvariabletext');
	
	if (locktextdiv.className == "unlocked"){
		locktextdiv.innerHTML = "Weet u zeker dat u deze groep wil vergrendelen? Er kunnen dan geen nieuwe groepsleden meer toetreden.";
	}
	if (locktextdiv.className == "locked"){
		locktextdiv.innerHTML = "Weet u zeker dat u deze groep open wil stellen? Er kunnen dan nieuwe groepsleden toetreden.";
	}
	
	var modalap = document.getElementById('lockmodal');
	modalap.style.display = "block";	
}

function close_span_lock(){
	var modalap = document.getElementById('lockmodal');
	modalap.style.display = "none";
}

function lock_group(){
	lock_status_local = "";
	lockdiv = document.getElementById('lockvariabletext');
	
	if (lockdiv.className == "unlocked"){
		lock_status_local = "locked";
	}
	if (lockdiv.className == "locked"){
		lock_status_local = "unlocked";
	}
	
	$.ajax({
		url: "http://84.28.82.98:8081/lock-group",
        type: 'POST',
		data: JSON.stringify({ authkey: authkey_local, gameid: gameid_local, lockstatus: lock_status_local}),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
        async: true,
        success: function(result) {
			document.getElementById('lockvariabletext').setAttribute("class", lock_status_local);
			if (result[0].lockstatus == "locked"){
				document.getElementById('lockicon').setAttribute("src", "locked.png");
			}
			if (result[0].lockstatus == "unlocked"){
				document.getElementById('lockicon').setAttribute("src", "unlocked.png");
			}
			close_span_lock();
		},
        error: function(data) {
        }
	});
}

function CheckGameLock(){
		
	$.ajax({
		url: "http://84.28.82.98:8081/check-lock",
        type: 'POST',
		data: JSON.stringify({ authkey: authkey_local, gameid: gameid_local}),
		contentType: "application/json; charset=utf-8",
		dataType: "json",
        async: true,
        success: function(result) {
			document.getElementById('lockvariabletext').setAttribute("class", result[0].lockstatus);
			if (result[0].lockstatus == "locked"){
				document.getElementById('lockicon').setAttribute("src", "locked.png");
			}
			if (result[0].lockstatus == "unlocked"){
				document.getElementById('lockicon').setAttribute("src", "unlocked.png");
			}
		},
        error: function(data) {
			alert("Vergrendelstatus van groep kan niet geladen worden door een server error.")
        }
	});
}
</script>
</body>
</html>
